---
title: "Descriptive Statistics & EpiAnalyses Report"
author: "Dewi Anastasia Christina"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
date: "`r format(Sys.time(), '%d %B %Y')`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

if(!require(pacman)) install.packages("pacman")
pacman::p_load(reactable, tidyverse, plotly)

```

## 1. Descriptive statistics

### 1.1. Methods

Pneumococcal carriage following PCV13 immunisation was assessed among children in two islands of Lesser Sunda Archipelago, Lombok and Sumbawa. We incorporated age group (\<1 year, 1-2 years, 3-5 years) along with other factors potentially influencing pneumococcal colonisation. *S. pneumoniae* species identification was determined using the combination of culture-based methods (physical characteristics and optochin assessment) and whole genome sequencing (WGS)-based approaches. I also test area as a potential confounder by implementing chi-square tests method from

To ensure accuracy on species identification, we evaluated the quality of genome assembly using **Bioconda::assembly-stats** (developed by Sanger Pathogens) and classified genomes into two categories: those with a genome length 1.9 Mb-2.3 Mb were considered pure pneumococcal genomes while those outside the ranges were classified as pneumococcal genomes with intra-species contamination. Further validation was performed using Torsten Seemann's **MLST** toolset, which conducts **BLAST** analysis on seven housekeeping genes. Multiple-serotype contamination was examined using Sheppard et al.'s **pneumoKITy**. Additionally, we uploaded the data to PathogenWatch (<http://pathogen.watch>) to obtain *in silico* identification of pneumococcus including their serotype determination, Global Pneumococcal Sequence Cluster (GPSC) classification, sequence type (ST), and antibiotic resistance profiling.

The vaccine serotypes included in PCV13 (1, 3, 4, 5, 6A, 6B, 7F, 9V, 14, 18C, 19A, 19F, and 23F). *S. pneumoniae* were classified as non-typeable if a serotype could not be determined *in silico*.

### 1.2. Results

### 1.2.1. EpiData

A total number of 900 children were evenly assessed from Lombok (n = 450, 50%) and Sumbawa (n = 450, 50%), with a slightly higher pneumococcal carriage in Sumbawa (n = 204, 45.33%) compared to Lombok (n = 192, 42.67%). Males and females were almost equally represented in the study, with 48.78% (n = 439) being male and 51.22% (n = 461) being female. The pneumococcal positivity rate was slightly lower among males (42.82% (188/439)) compared to females (45.12% (208/461)).

Among children assessed in Lombok, 3.78% (17/450) were under 1 year of age, with a pneumococcal positivity rate of 47.06% (8/17). In Sumbawa, 34.67% (156/450) of children were under 1 year, with a similar positivity rate of 44.87% (70/156). Overall, 19.22% (173/900) of the total study population was in this age group, with 45.09% (78/173) testing positive. For children aged 1–2 years, 36.67% (165/450) of those in Lombok were assessed, and 46.67% (77/165) were positive, while in Sumbawa, 42.44% (191/450) were assessed, with a 46.6% (89/191) positivity rate. Across both islands, 39.56% (356/900) of children were in this age group, with 46.63% (166/356) testing positive. Among children aged 3–5 years, 59.56% (268/450) in Lombok were assessed, with 39.93% (107/268) testing positive. In Sumbawa, this age group accounted for 22.89% (103/450) of the population, with a positivity rate of 43.69% (45/103). Overall, 41.22% (371/900) of children were in this category, with a pneumococcal positivity rate of 40.97% (152/371).

Children who received three doses of the Hib pentavalent vaccine accounted for 51% (n = 459) of the study population, with a positivity rate of 45.1% (n = 207). Those who received four doses made up 49% (n = 441), with a slightly lower positivity rate of 42.86% (n = 189). Children who received one to two mandatory doses of the PCV13 accounted for 40.56% (n = 365) of the study population, with a positivity rate of 41.37% (n = 151). Those who received three to four doses made up 59.44% (n = 535), with a slightly higher positivity rate of 45.79% (n = 245).

Table 1

```{r}
report_epiTable <- 
  #read.csv("../outputs/epi_all_descriptive_percentages_report.csv") %>% 
  read.csv("../outputs/epi_all_descriptive_percentages_report_with_pValues.csv") %>% 
  dplyr::rename_with(~ gsub("report_", "", .x)) %>% 
  dplyr::mutate(estimate = round(estimate, 3),
                lower = round(lower, 3),
                upper = round(upper, 3),
                midp.exact = round(midp.exact, 3),
                fisher.exact = round(fisher.exact, 3),
                chi.square = round(chi.square, 3))

DT::datatable(report_epiTable, filter = "top",
              options = list(
                dom = 'Bfrtip',  # 'B' enables buttons, 'frtip' keeps search/filtering
                buttons = list('colvis'),  # column visibility toggle
                pageLength = 10,
                lengthMenu = list(c(5, 10, 25, -1),
                                  c("5 rows", "10 rows", "25 rows", "All"))
                ),
              extensions = 'Buttons')
```

### 1.2.2. Genome data

Pending

Filter out the data:

From positive samples, how many data failed to be processed due to RNA contaminations, etc.

Subset the data to only WGS-processed samples:

MLST, pneumoKITy and contamination profiles.

vaccine-types and non-vaccine-types

## 2. Modelling

### 2.1. Methods

To determine the factors associated with the prevalence of pneumococcal carriage, we first tested area as a potential confounding factor. We then implemented a multivariable logistic regression model with a stepwise backward elimination process, including all covariates from a set of selected variables that exhibited no high collinearity. Variables with a significance level greater than 0.05 were removed from the model. All statistical analyses and data visualizations were performed using R version 4.4.3. P values \< 0.05 were considered statistically significant.

### 2.2. Results

### 2.2.1. EpiData

Having more children in a household was strongly associated with pneumococcal carriage:

Runny nose in the past 24 h (adjusted OR = 1.62, 95% CI = 1.19-2.22) was significantly associated with pneumococcal carriage, while other variables were considered not statistically significant. Oddly enough, contact with other children have a decreasing effect in pneumococcal carriage (adjusted OR = 0.66, 95% CI = 0.44-0.99). In a multivariate analysis,

In a multivariate analysis, the odds of pneumococcal carriage varied significantly by several characteristics: children aged 1–2 years had a 1.7-fold-increased odds compared to children aged \<1 year (*P* = 0.0008), households with the presence of other children \<5 years old had a 1.9-fold-increased odds compared to those without (*P*\<0.0001), households with 4–6 persons had a 0.8-fold-decreased odds compared to households with 2–3 persons (*P* = 0.012), households using wood only as the primary fuel source had a 4.8-fold-increased odds (*P*\<0.0001) while households using wood with any other source had a 0.8-fold-decreased odds (*P*\<0.0001) compared to households using LPG or kerosene only, exposure to cigarette smoke in the household was associated with a 0.8-fold-decreased odds (*P* = 0.034), and the presence of ≥1 symptom of respiratory illness was associated with a 2.8 fold-increased odds (*P*\<0.0001) ([Table 2](https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0297041#pone-0297041-t002)).

```{r}
# same data but focused on only final model plus filtered variables
report_model <- 
  read.csv("../outputs/epi_all_final_models.csv") %>% 
  dplyr::select(variable, value,
                univar_crude_OR_report, univar_crude_p.value,
                univar_plusArea_report, univar_plusArea_p.value,
                multivar_model1_report_OR, multivar_model1_p_value,
                # multivar_model2_report_OR, multivar_model2_p_value,
                multivar_final_report_OR, multivar_final_prz) %>% 
  dplyr::mutate(univar_crude_p.value = round(univar_crude_p.value, 2),
                univar_plusArea_p.value = round(univar_plusArea_p.value, 2),
                multivar_model1_p_value = round(multivar_model1_p_value, 2),
                # multivar_model2_p_value = round(multivar_model2_p_value, 2),
                multivar_final_prz = round(multivar_final_prz, 2))

DT::datatable(report_model, filter = "top",
              options = list(
                dom = 'Bfrtip',  # 'B' enables buttons, 'frtip' keeps search/filtering
                buttons = list('colvis'),  # column visibility toggle
                pageLength = 10,
                lengthMenu = list(c(5, 10, 25, -1),
                                  c("5 rows", "10 rows", "25 rows", "All"))
                ),
              extensions = 'Buttons')
```

```{r}
# same data but focused on only final model plus filtered variables
report_model_filtered <- 
  read.csv("../outputs/epi_all_final_models.csv") %>% 
  dplyr::select(variable, value,
                univar_crude_OR_report, univar_crude_p.value,
                univar_plusArea_report, univar_plusArea_p.value,
                multivar_model1_report_OR, multivar_model1_p_value,
                # multivar_model2_report_OR, multivar_model2_p_value,
                multivar_final_report_OR, multivar_final_prz) %>% 
  dplyr::mutate(univar_crude_p.value = round(univar_crude_p.value, 2),
                univar_plusArea_p.value = round(univar_plusArea_p.value, 2),
                multivar_model1_p_value = round(multivar_model1_p_value, 2),
                # multivar_model2_p_value = round(multivar_model2_p_value, 2),
                multivar_final_prz = round(multivar_final_prz, 2)) %>% 
  dplyr::filter(!is.na(multivar_final_prz),
                value != "(Intercept)")

DT::datatable(report_model_filtered, filter = "top",
              options = list(
                dom = 'Bfrtip',  # 'B' enables buttons, 'frtip' keeps search/filtering
                buttons = list('colvis'),  # column visibility toggle
                pageLength = 10,
                lengthMenu = list(c(5, 10, 25, -1),
                                  c("5 rows", "10 rows", "25 rows", "All"))
                ),
              extensions = 'Buttons')
```

Sort of goodness of fit

```{r}
knitr::include_graphics("../pictures/epiAnalyses_all_multivariable_final_model.png")
```

However, the analysis indicated that area was not a confounder

### 2.2.2. Genome data

ssssss

Multivariate analyses for serotype related to carriage, vaccine types and non-vaccine types,

## 3. Discussion and conclusion
